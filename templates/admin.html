{% extends "base.html" %}
{% block content %}
<h2 class="text-2xl font-bold mb-6">ğŸ“Š Admin Dashboard</h2>

<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
  <div class="bg-white shadow rounded-lg p-4">
    <h3 class="font-semibold mb-2">ğŸ“Œ Event Popularity</h3>
    <button id="popularity-btn" class="bg-indigo-600 hover:bg-indigo-700 text-white px-3 py-1 rounded text-sm">Load</button>
  </div>

  <div class="bg-white shadow rounded-lg p-4">
    <h3 class="font-semibold mb-2">ğŸ™‹ Student Participation</h3>
    <button id="participation-btn" class="bg-indigo-600 hover:bg-indigo-700 text-white px-3 py-1 rounded text-sm">Load</button>
  </div>

  <div class="bg-white shadow rounded-lg p-4">
    <h3 class="font-semibold mb-2">ğŸ“‘ Event Summary</h3>
    <input type="number" id="summary-event-id" placeholder="Enter Event ID" class="border rounded px-2 py-1 text-sm w-full mb-2">
    <button id="summary-btn" class="bg-green-600 hover:bg-green-700 text-white px-3 py-1 rounded text-sm">Get Summary</button>
  </div>

  <div class="bg-white shadow rounded-lg p-4">
    <h3 class="font-semibold mb-2">ğŸ† Top Students</h3>
    <button id="top-btn" class="bg-yellow-500 hover:bg-yellow-600 text-white px-3 py-1 rounded text-sm">Show Top 3</button>
  </div>

  <div class="bg-white shadow rounded-lg p-4">
    <h3 class="font-semibold mb-2">ğŸ¯ Filter by Event Type</h3>
    <select id="event-type" class="border rounded px-2 py-1 text-sm w-full mb-2">
      <option value="Workshop">Workshop</option>
      <option value="Seminar">Seminar</option>
      <option value="Fest">Fest</option>
      <option value="Talk">Talk</option>
      <option value="Hackathon">Hackathon</option>
    </select>
    <button id="filter-btn" class="bg-green-600 hover:bg-green-700 text-white px-3 py-1 rounded text-sm">Filter</button>
  </div>

  <div class="bg-white shadow rounded-lg p-4">
    <h3 class="font-semibold mb-2">ğŸ’¬ Event Feedback</h3>
    <input type="number" id="feedback-event-id" placeholder="Enter Event ID" class="border rounded px-2 py-1 text-sm w-full mb-2">
    <button id="feedback-btn" class="bg-pink-500 hover:bg-pink-600 text-white px-3 py-1 rounded text-sm">View Feedback</button>
  </div>
</div>

<div id="report" class="mt-6 bg-white shadow rounded-lg p-4"></div>

<script>
document.getElementById("popularity-btn").addEventListener("click", async () => {
  let res = await fetch("/reports/events/popularity");
  let data = await res.json();
  let html = "<h3>ğŸ“Œ Event Popularity</h3><ul>";
  data.forEach(e => { html += `<li>${e.title} â†’ ${e.registrations} registrations</li>`; });
  html += "</ul>";
  document.getElementById("report").innerHTML = html;
});

document.getElementById("participation-btn").addEventListener("click", async () => {
  let res = await fetch("/reports/students/participation");
  let data = await res.json();
  let html = "<h3>ğŸ™‹ Student Participation</h3><ul>";
  data.forEach(s => { html += `<li>${s.name} â†’ ${s.events_attended} events</li>`; });
  html += "</ul>";
  document.getElementById("report").innerHTML = html;
});

document.getElementById("summary-btn").addEventListener("click", async () => {
  let id = document.getElementById("summary-event-id").value;
  let res = await fetch(`/reports/events/${id}/summary`);
  let data = await res.json();
  let html = `<h3>ğŸ“‘ Event Summary (ID: ${id})</h3>
    <p>Registrations: ${data.registrations}</p>
    <p>Attendance %: ${data.attendance_pct}</p>
    <p>Average Rating: ${data.avg_rating}</p>`;
  document.getElementById("report").innerHTML = html;
});

document.getElementById("top-btn").addEventListener("click", async () => {
  let res = await fetch("/reports/students/top");
  let data = await res.json();
  let html = "<h3>ğŸ† Top 3 Students</h3><ul>";
  data.forEach(s => { html += `<li>${s.name} â†’ ${s.events_attended} events</li>`; });
  html += "</ul>";
  document.getElementById("report").innerHTML = html;
});

document.getElementById("filter-btn").addEventListener("click", async () => {
  let type = document.getElementById("event-type").value;
  let res = await fetch(`/reports/events/by_type/${type}`);
  let data = await res.json();
  let html = `<h3>ğŸ” Events of type: ${type}</h3><ul>`;
  data.forEach(e => { html += `<li>${e.title} (${e.location})</li>`; });
  html += "</ul>";
  document.getElementById("report").innerHTML = html;
});

document.getElementById("feedback-btn").addEventListener("click", async () => {
  let id = document.getElementById("feedback-event-id").value;
  let res = await fetch(`/feedback/${id}/list`);
  let data = await res.json();
  let html = `<h3>ğŸ’¬ Feedback for Event ${id}</h3><ul>`;
  data.forEach(f => { html += `<li>Student ${f.student_id} â†’ Rating: ${f.rating}, Comment: ${f.comment || "No comment"}</li>`; });
  html += "</ul>";
  document.getElementById("report").innerHTML = html;
});
</script>

{% endblock %}
